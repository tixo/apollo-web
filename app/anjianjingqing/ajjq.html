<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <link href="../anjianjingqing/css/daterangepicker.css" rel="stylesheet">
    <link rel="stylesheet" href="../anjianjingqing/css/bootstrap.css"/>
    <link rel="stylesheet" href="../../config/common/rightResource/css/right_resource.css" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/ajjq.css"/>
    <link rel="stylesheet" type="text/css" href="css/periphery_list.css"/>
    <link rel="stylesheet" type="text/css" href="../yibiaosanshi/css/ybss.css"/>
    <link rel="stylesheet" href="../../config/common/mapTools/css/map_tools.css" type="text/css">
    <link rel="stylesheet" href="../../module/plugins/scrollbar/jquery.mCustomScrollbar.css" type="text/css">
    <link rel="stylesheet" href="../../config/common/camera/css/camera.css" type="text/css">
    <script type="text/javascript" src="../../supermap/webgl/module/jquery/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="../../module/plugins/scrollbar/jquery.mCustomScrollbar.js"></script>
    <script type="text/javascript" src="../../module/plugins/scrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
    <script type="text/javascript" src="../../module/template.js"></script>
    <script type="text/javascript" src="../../config/common/classie.js"></script>
    <script type="text/javascript" src="../../supermap/webgl/supermap/3D/webgl.Include3D.js"></script>
    <script type="text/javascript" include="iclient-classic" src="../../supermap/9D-leaflet/dist/include-classic.js"></script>
    <script type="text/javascript" src="../../module/sea/sea.js"></script>
    <link rel="stylesheet" type="text/css" href="../yibiaosanshi/css/zTreeStyle.css"/>
    <script type="text/javascript" src="../../module/plugins/zTree/js/jquery.ztree.core.min.js"></script>
    <script type="text/javascript" src="../../module/plugins/zTree/js/jquery.ztree.excheck.js"></script>
    <script type="text/javascript" src="../../module/plugins/zTree/js/jquery.ztree.exhide.js"></script>
    <script type="text/javascript" src="../anjianjingqing/js/moment.min.js"></script>
    <script type="text/javascript" src="../anjianjingqing/js/daterangepicker.js"></script>
    <link rel="stylesheet" type="text/css" href="../../module/plugins/datetimepicker/jquery.datetimepicker.css">
    <script type="text/javascript"src="../../module/plugins/datetimepicker/build/jquery.datetimepicker.full.js"></script>

    <script type="text/javascript" src="../../config/common/camera/js/flv.js"></script>
    <script src="../../scheduling/dist/plugins/layer/layer.js"></script>
    <script type="text/javascript" src="../../scheduling/case/transformGcj02OrWgs84.js"></script>
    <title>案件警情</title>
</head>

<body class="cbp-spmenu-push" style="overflow: hidden;">
<iframe src="" id="aj-manage-ctn" class="aj-manage-ctn" name="aj-manage-ctn"></iframe>
<div class="main-content">
    <div class="sidebar" role="navigation">
        <div class="navbar-collapse">
            <nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-right dev-page-sidebar " id="cbp-spmenu-s1">
                <div class="left-box">
                    <button id="showLeftPush" class="showLeftPushBg"></button>
                    <div class="zuoce-box">
                        <div class="main">
                            <ul class="tab_nav">

                            </ul>
                            <iframe id="myFrameId" class="myFrameId" src="" name="myFrameName" scrolling="no"
                                    frameborder="0"></iframe>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </div>
    <div id="page-wrapper">
        <!--加载map tools  zhangai  	start -->
        <!--<span id="map-tools3D"></span>
        <span id="map-tools" style="display: none;"></span>-->
        <!--end -->
        <!--加载3维场景模块-->
        <div id="cesiumContainer" style="width: calc(100% - 293px)"></div>
        <!--加载2维场景模块-->
        <div id="map" class="map-background" style="width:100%;height:100%;position:absolute ;display: none;"></div>
        <!--end -->
        <!--加载map cut 地图切换  zhangai  	start -->
        <span id="map_cut" style="position:absolute ;right:10px;bottom:48px;"></span>
        <div class="time-box">
            <ul class="shuxian">
                <span class="lft"></span>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li><span></span></li>
            </ul>
            <div class="bg-zhou" id="zhuWz">
                <div class="modal-time" id="now">
                    <div class="modal-time-an"></div>
                </div>
            </div>
            <ul class="shu" id="timelineAdd">
            </ul>
        </div>
        <div class="ajtx-box" id="ajtx-box">
            <div class='criminal'>
                <span class='aj-name'>今日刑事案件</span><span class='time' id="numXs1">0</span>
                <span class='time' id="numXs2">0</span>
                <span class='aj-name mg'>治安案件</span><span class='time' id="numZa1">0</span>
                <span class='time' id="numZa2">0</span>
                <span class='aj-name mg'>调解纠纷与救助</span><span class='time' id="numQt1">0</span>
                <span class='time' id="numQt2">0</span>
            </div>
        </div>
        <div class="addressSearch" style="position: relative;">
			<input type="text" class="car-ss address-input" id="addressMapSearch"  placeholder="地址搜索...">
			<button class="ss-btn" style="width: 28px;height: 20px;outline:none;top:5px;right:2px;" onclick="majjq.mapAddressSearch.ok()"><img src="../../config/common/rightResource/img/search-1.png"></button>
		</div>
        <div class="modal-maximize-box" style="height: 300px;">
            <div class="modal-maximize-box-top">案件详情
                <span class="modal-maximize-box-clear">关闭</span>
            </div>
            <div class="modal-maximize-box-ctn">
                <ul class="tab-title">
                    <li></li>
                    <li></li>
                    <li></li>
                </ul>
            </div>
        </div>
        <div class="police-resource-list-box">
            <div class="police-resource-top">
                设备列表
                <span class="police-resource-clear" onclick="majjq.closeZhoubian()">关闭</span>
            </div>
            <div class="police-resource-ctn">
                <table class="tab-police">

                </table>
            </div>
        </div>
        <div class="shipin-log-box" style="display: none;z-index: 999;">
            <div class="shipin-log-top" onclick="_rightResource.video.closeVideo()">
                <span class="log-clear">x</span> 监控记录
            </div>
            <div class="shipin-log-ctn"></div>
            <div class="shipin-btn-box">
                <div>
                    <div class="log-caozuo-btn">
                        <span class="log-img"><img src="img/add.png"></span>
                        <span>添加记录</span>
                    </div>
                    <div class="log-caozuo-btn log-caozuo-btn2">
                        <span class="log-img"><img src="img/delete-1.png"></span>
                        <span>删除记录</span>
                    </div>
                    <div class="jilu">
                        共
                        <span>
									6
								</span> 条
                    </div>
                </div>
            </div>
        </div>
        <div class="tuli">
            <p>图例</p>
            <ul id="tuli">
                <li>
						<span>
								<img src="img/xs.png">
							</span>
                    <span>刑事案件</span>
                </li>
                <li>
						<span>
								<img src="img/za.png">
							</span>
                    <span>治安案件</span>
                </li>
                <li>
						<span>
								<img src="img/qt.png">
							</span>
                    <span>调解纠纷与救助</span>
                </li>
            </ul>
        </div>
        <!--end -->
    </div>

    <!--放大气泡-->
    <div class="modal-fangda">
        <div class="modal-fangda-top">
            案件详情
            <span class="modal-fangda-clear">关闭</span>
        </div>
        <div class="modal-fangda-ctn" id="fada-data-ctn" style="overflow: auto;height: 90%;">

        </div>
    </div>
</div>
<div class="tableanjian" id="latestCase">
</div>
<!--加载 右侧资源  zhangai  	start -->
<div id="right-resource"></div>
</body>
<script>
    var majjq, _rightResource, websocketHandle, mbuilding;
    //获取场景配置信息
    var services = parent.window.services;
    seajs.config({base: "./js/"});
    seajs.use(["ajjq.js"], function (ajjq) {
        majjq = ajjq;
        mbuilding = majjq;
        mbuilding.queryFeature = majjq.ajjqSceneEvent;
        majjq.ajjqSceneEvent.initScene(services);
        majjq.initUi();
        _rightResource = majjq.rightResource;
        websocketHandle = majjq.websocketHandle;
        $('#myFrameId').attr('src', "ajjq_today.html");
        $("#timelineAdd").html(ajjq.timeLine.initTimeline());
    });
    var menuLeft = document.getElementById('cbp-spmenu-s1'),
        showLeftPush = document.getElementById('showLeftPush'),
        body = document.body;
    var parentDoc = parent.document;
    /* 定义一个接收元素的变量 */
    var thisIframe = null;
    $("iframe", parentDoc).each(function (index, e) {
        if (e.src.indexOf("ajjq.html") > 0) {
            thisIframe = e;
            thisIframe.ajjq = true;
            return false;
        }
    });
    showLeftPush.onclick = function () {
        classie.toggle(this, 'active');
        classie.toggle(body, 'cbp-spmenu-push-toright');
        classie.toggle(menuLeft, 'cbp-spmenu-open');
        $(this).toggleClass('showRightPushBg');
        var left = $("#cesiumContainer").css("left");
        if ($(".showRightPushBg").length > 0) {
            $("#cesiumContainer").css({
                "left": "0",
                "width": "100%"
            });
            $("#map").css({
                "left": "0",
                "width": "100%"
            });
            $(".time-box").css({
                "width": "100%"
            });
        } else {
            $("#cesiumContainer").css({
                "left": "293px",
                "width": "calc(100% - 293px)"
            });
            $("#map").css({
                "left": "293px",
                "width": "100%"
            });
            $(".time-box").css({
                "width": "calc(100% - 293px)"
            });
        }
    };
    //子菜单动态加载
    var zcdHtml = "";
    $.each(services.new_menus, function (i, item) {
        var select = "unsel";
        if (i == 0) {
            select = "select";
            if (item.id == "s_jraj" || item.id == "s_lsaj") {
                $("#myFrameId").attr("src", item.href);
            } else {
                $("#aj-manage-ctn").attr("src", item.href);
                $("#aj-manage-ctn").show();
                $("#myFrameId", "#page-wrapper").hide();
            }
        } else {
            select = "unsel";
        }
        if (item.id == "s_jraj" || item.id == "s_lsaj") {
            zcdHtml += '<li class="tab ' + select + '" data-id="' + item.id + '"><a href="' + item.href + '" class="a" target="myFrameName">' + item.name + '</a></li>';
        } else {
            zcdHtml += '<li class="tab ' + select + '" data-id="' + item.id + '"><a href="' + item.href + '" class="a" target="aj-manage-ctn">' + item.name + '</a></li>';
        }
    });
    $(".tab_nav").html(zcdHtml);

    function disableOther(button) {
        if (button !== 'showLeftPush') {
            classie.toggle(showLeftPush, 'disabled');
        }
    }
    //加载右侧资源 zhangai
    $.get("../../config/common/rightResource/right_resource.html", function (data) {
        $("#right-resource").html(data);
    });
    //加载地图切换 zhangai
    $.get("../../config/common/mapCut/map_cut.html", function (data) {
        $("#map_cut").html(data);

    });
    //modal操作
    $(".clear-win").click(function () {
        $(".modal-backdrop-box").hide();
    });
    $(".maximize").click(function () {
        $(".modal-maximize-box").show();
    });
    $(".modal-maximize-box-clear").click(function () {
        $(".modal-maximize-box").hide();
    });
    //加载地图切换 zhangai
    $.get("../../config/common/mapCut/map_cut.html", function (data) {
        $("#map_cut").html(data);
    });
    $.get("../../app/yibiaosanshi/buildingPopup.html", function (data) {
        $("body").append(data);
    });
</script>
<script type="text/javascript" src="../../config/common/camera/js/camera.js"></script>
<script id="videoRecord" type="text/html">
    <table class="tab-shipin-log">
        <thead>
        <tr>
            <th>记录时间</th>
            <th>可用时间</th>
            <th>特征点</th>
            <th>编辑</th>
        </tr>
        </thead>
        <tbody id="tbody">
        {{each list}}
        <tr>
            <td>{{$value.creatTime}}</td>
            <td>
                <input type="text" class="ipt-stime" value="{{$value.usableStartTime}}"> s至
                <input type="text" class="ipt-stime" value="{{$value.usableEndTime}}"> s
            </td>
            <td>
                <select class="ipt-sect">
                    <option {{$value.features==
                    '嫌疑人'? 'selected' : ''}}>嫌疑人</option>
                    <option {{$value.features==
                    '证人'? 'selected' : ''}}>证人</option>
                </select>
            </td>
            <td class="tb-btn">
                <a href="javascript:;" onclick="right()">
                    <img src="img/right.png"/>
                </a>
                <a href="javascript:;" onclick="updateVideoRecord(this)">
                    <img src="img/updating.png"/>
                </a>
                <a href="javascript:;" onclick="deleteVideoRecord(this)">
                    <img src="img/delete-1.png"/>
                </a>
            </td>
        </tr>
        {{/each}}
        </tbody>
    </table>
</script>

<script id="caseDetailsPopup" type="text/html">
    <div id="popup" class="mypopup" style="height: 213px">
        <div class="popup02-left-box">
            <div class="modal-title">
                案件信息
                <span id="popupCloseBtn" onclick="majjq.closeCase()">x</span>
            </div>
            <div class="popup_middle">
                <table cellspacing="0" class="tab tab-renkou" id="tab-danwei">
                    <tr>
                        <td>编号：</td>
                        <td>{{content.caseNumber}}</td>
                    </tr>
                    <tr>
                        <td>时间：</td>
                        <td>{{content.time}}</td>
                    </tr>
                    <tr>
                        <td>类型：</td>
                        <td>{{content.type}}</td>
                    </tr>
                    <tr>
                        <td>位置：</td>
                        <td>{{content.place}}</td>
                    </tr>
                </table>
            </div>
            <div class="modal-bottom-operate ">
                <a href="javascript:void(0)" class="modal-ctn-btn-aj aj-round" data-x="{{content.X}}"
                   data-y="{{content.Y}}" onclick="majjq.drawPolygon(this)">周边搜索</a>
                <a href="javascript:void(0)" class="modal-ctn-btn-aj aj-details"
                   onclick="majjq.ajDetails('{{content.id}}',this)">案件详情</a>
            </div>
            <div class="popup_bottom"></div>
        </div>
        <div class="popup02-right-box"
             style="position: fixed;margin-left: 302px;background-color: white;height: 213px;">
        </div>
    </div>
</script>
<script id="zhoubianPopup" type="text/html">
    <div class="modal-title">
        周边搜索
        <span id="popupCloseBtn" onclick="majjq.closeZhoubian()">x</span>
    </div>
    <div class="popup_middle">
        <ul class="aj-ctn-round" style="margin-bottom:70px ;">
            <li>
                <div>
                    <img src="img/electronic-police.png">
                </div>
                <div>
                    <input type="checkbox" class="chk1" name="zhoubian" value="dzjc" data-typename="电子警察">
                </div>
                <div>
                    <span>电子警察</span>
                </div>
            </li>
            <li>
                <div>
                    <img src="img/paichusuo.png">
                </div>
                <div>
                    <input type="checkbox" class="chk1" name="zhoubian" value="pcs" data-typename="派出所">
                </div>
                <div>
                    <span>派出所</span>
                </div>
            </li>
            <!--<li>
                <div>
                    <img src="img/gangting.png">
                </div>
                <div>
                    <input type="checkbox" class="chk1" name="zhoubian" value="gt" data-typename="岗亭">
                </div>
                <div>
                    <span>岗亭</span>
                </div>
            </li>-->
            <!--<li>
                <div>
                    <img src="img/hxz.png">
                </div>
                <div>
                    <input type="checkbox" class="chk1" name="zhoubian" value="zzazqd" data-typename="治安执勤点">
                </div>
                <div>
                    <span>治安执勤点</span>
                </div>
            </li>-->
            <!--<li>
                <div>
                    <img src="img/map-video.png">
                </div>
                <div>
                    <input type="checkbox" class="chk1" name="zhoubian" value="video" data-typename="摄像头">
                </div>
                <div>
                    <span>摄像头</span>
                </div>
            </li>-->
        </ul>
        <span style="font-size:14px;width: 80px;">搜索半径：</span><input type="text" class="ipt-panel ipt-panel-r" id="r"
                                                                     value="1000" placeholder="请输入半径"
                                                                     autofocus="autofocus">
        <a href="#" class="aj-erji-modal-search">开始查找</a>
    </div>
    </div>
</script>
<script id="xqPopup" type="text/html">
    <div class="modal-title">
        案件详情
        <span id="popupCloseBtn" onclick="majjq.closeZhoubian()">x</span>
        <span class="fd maximize"><img src="img/big.png" onclick="majjq.max(this)"></span>
    </div>
    <div class="popup_middle" id="caseDetailsTable" style="height: 178px;">
        <table class="tab-detail">
            <tr>
                <td>案件编号</td>
                <td>{{content.caseNumber}}</td>
            </tr>
            <tr>
                <td>报警时间</td>
                <td>{{content.time}}</td>
            </tr>
            <tr>
                <td>报警方式</td>
                <td>{{content.alarmMode}}</td>
            </tr>
            <tr>
                <td>报警人</td>
                <td>{{content.name}}</td>
            </tr>
            <tr>
                <td>报警人电话</td>
                <td>{{content.telephone}}</td>
            </tr>
            <tr>
                <td>报警人性别</td>
                <td>{{content.sex}}</td>
            </tr>
            <tr>
                <td>报警人年龄</td>
                <td>{{content.age}}</td>
            </tr>
            <tr>
                <td>警情位置</td>
                <td>{{content.place}}</td>
            </tr>
            <tr>
                <td>警情类别</td>
                <td>{{content.categoryName}}{{content.subCategoryName}}</td>
            </tr>
            <tr>
                <td>级别</td>
                <td>{{content.levels}}</td>
            </tr>
            <tr>
                <td>是否有损失</td>
                <td>{{content.isLoss}}</td>
            </tr>
            <tr>
                <td>受理时间</td>
                <td>{{content.disposeTime}}</td>
            </tr>
            <tr>
                <td>接警人</td>
                <td>{{content.policeOfficer}}</td>
            </tr>
            <tr>
                <td>到达现场时间</td>
                <td>{{content.arrivalTime}}</td>
            </tr>
            <tr>
                <td>报警内容</td>
                <td>{{content.detail}}</td>
            </tr>
            <tr>
                <td>处警单位</td>
                <td>{{content.disposeName}}</td>
            </tr>
            <tr>
                <td>处警结果</td>
                <td>{{content.result}}</td>
            </tr>
        </table>
    </div>
</script>
<script id="latestCasePopup" type="text/html">
    <!--案件报警信息框-->
    <div class="right-panel-top">
        <span class="clert-guiji" style="height: 10px;" data-toggle="tooltip" data-placement="top" title="关闭"
              id="closebktable">x</span>
    </div>
    <table class="anjiantablepanel tab tab-renkou" cellspacing="0">
        <tr>
            <td colspan="2" style="color:steelblue;text-align: center !important;">实时最新案件提醒</td>
        </tr>
        <tr>
            <td>案件类型</td>
            <td>{{content.type}}</td>
        </tr>
        <tr>
            <td>案件时间</td>
            <td>{{content.time}}</td>
        </tr>
        <tr>
            <td>案件地点</td>
            <td>{{content.place}}</td>
        </tr>
        <tr></tr>
    </table>
    </div>
</script>
</html>
